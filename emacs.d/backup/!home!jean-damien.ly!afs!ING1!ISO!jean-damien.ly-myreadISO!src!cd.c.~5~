#include "myiso.h"

void cd_command(char **fp, char *read, int index)
{
    if ((strcmp(read, "") == 0) || (strcmp(read, "..") == 0))
    {
        *fp = get_mmap();
        printf("Changing to '/' directory\n");
    }
    else if (strcmp(read, ".") == 0)
    {
        printf("Changing to '/' directory\n");
    }
    else
    {
        void *ident = get_mmap() + ISO_PRIM_VOLDESC_BLOCK * ISO_BLOCK_SIZE;
        struct iso_prim_voldesc *voldesc = ident;
        struct iso_dir dir = voldesc->root_dir;
        index = dir.data_blk.le;
        char *root = get_mmap();
        if (strcmp(root, *fp) != 0)
            *fp -= (index * ISO_BLOCK_SIZE);
        void *tmp = check_argument(*fp, read, index);
        if (!tmp)
            return;
        char *c = tmp;
        c -= (index * ISO_BLOCK_SIZE);
        tmp = c;
        *fp = tmp;
        printf("Changing to '%s' directory\n", read);
    }
}