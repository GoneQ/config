#include "myfind.h"

static int verify_predicate(char *s)
{
    if (s[0] == '-')
    {
        if (s[1] != '\0')
        {
            if (s[2] == '\0')
                return 1;
        }
    }
    return 0;
}

int get_expression(int argc, char *argv[], char **exp)
{
    int i = 1;
    for (; (i < argc) && (verify_predicate(argv[i]) == 1); i++);
    char *s = argv[i];
    if (my_strcmp(s, "-name") == 0)
    {
        if (i + 1 < argc)
        {
            *exp = argv[i + 1];
            return 1;
        }
    }
    else if (my_strcmp(s, "-type") == 0)
    {
        if (i + 1 < argc)
        {
            *exp = argv[i + 1];
            return 1;
        }
    }
    else if ((my_strcmp(s, "-type") == 0) || (my_strcmp(s, "-name") == 0))
        warnx("missing argument to '%s'", argv[i]);
    return 0;
}

int check_expression(struct dirent *de, int got, char *exp)
{
    if (got == 0)
    {
        return 1;
    }
    int i = fnmatch(exp, de->d_name, 0);
    //printf("exp %s, try %s: res %d\n", exp, de->d_name, i);
    return !i;
}